<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Find a location</title>

  <script>
    var API_KEY = 'AIzaSyBwsSIVLU_0NgCSbr4ww1j-n_zaqWrM_S8';
    var GOOGLE_SHEET = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRaUjtO_tH1bC35QFWGaHd1kZleUFCeKwegB6DHS_MSV6D0WwFvPbK2X8k7tBdEirlgRQaXV8HxbTuY/pubhtml'
  </script>
  <!-- Google Maps API Script -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwsSIVLU_0NgCSbr4ww1j-n_zaqWrM_S8&callback=initMap"
    async defer></script>
</head>

<body>
  <!--  Map container -->
  <div id="container">
    <div id="map"></div>

    <!-- List of locations -->
    <div id="locationTable">
      <h2>Locations</h2>
      <table>
        <thead>
          <tr>
            <th>Photo</th>
            <th>Name</th>
            <th>Address</th>
            <th>Phone</th>
          </tr>
        </thead>
        <tbody id="locationData"></tbody>
      </table>
    </div>
  </div>

  <!-- Show pages for each location -->
  <!-- List of locations -->
  <div id="locationTable">
    <h2>Locations</h2>
    <table>
      <tr>
        <th>Photo</th>
        <th>Name</th>
        <th>Address</th>
        <th>Phone</th>
      </tr>
      <tr>
        <td><img src="resources/placehold.jpg" alt="Location 1 Photo" width="100" height="100"></td>
        <td>Location 1</td>
        <td>123 Main St</td>
        <td>(123) 456-7890</td>
      </tr>
      <tr>
        <td><img src="resources/placehold.jpg" alt="Location 2 Photo" width="100" height="100"></td>
        <td>Location 2</td>
        <td>456 Elm St</td>
        <td>(987) 654-3210</td>
      </tr>
    </table>
  </div>

  <!-- Fetch Data Button -->
<button onclick="fetchData()">Fetch Data</button>

<!-- Container for Data -->
<div id="dataContainer">
  <h2>Data from Google Sheet</h2>
  <table>
    <thead>
      <tr>
        <th>Photo</th>
        <th>Name</th>
        <th>Address</th>
        <th>Phone</th>
      </tr>
    </thead>
    <tbody id="locationData"></tbody>
  </table>
</div>
</body>

</html>





<!-- Misc Functions / JavaScript -->
<script>
  // Initialize the map
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: 35.12384, lng: -106.62723 }, // Center of Albuquerque
      zoom: 11, // Adjust the zoom level as needed
      // Customize the map options
      disableDefaultUI: true, // Disables all default UI controls
      zoomControl: true, // Enables the zoom control
    });
  }

  function fetchData() {
    console.log('Fetching data...');
    const dataContainer = document.getElementById('locationData');

    // Make a request to the Google Sheet
    fetch(GOOGLE_SHEET)
      .then((response) => response.text())
      .then((data) => {
        // Process the data here and populate the dataContainer
        console.log('Data fetched:', data);
        parseGoogleSheetData(data, dataContainer);
      })
      .catch((error) => {
        console.error('Error fetching data:', error);
      });
    console.log('Done fetching data.');
  }

  function parseGoogleSheetData(data, container) {
  // Use regular expressions to find entries with the format "class="sX">...</td>"
  const regex = /class="s(\d+)">([^<]+)<\/td>/g;

  // Initialize an object to store data for each index
  const dataByIndex = {};

  // Iterate through the data using regular expressions
  let match;
  while ((match = regex.exec(data)) !== null) {
    const index = match[1];
    const value = match[2];

    // Create an array for the index if it doesn't exist
    if (!dataByIndex[index]) {
      dataByIndex[index] = [];
    }

    // Push the value into the array for the corresponding index
    dataByIndex[index].push(value);
  }

  // Create the HTML rows and populate the table
  const htmlRows = [];
  for (const index in dataByIndex) {
    const rowData = `
      <tr>
        <td><img src="resources/placehold.jpg" alt="Location ${index} Photo" width="100" height="100"></td>
        <td>Location ${index}</td>
        <td>${dataByIndex[index].join('</td><td>')}</td>
      </tr>
    `;
    htmlRows.push(rowData);
  }

  // Display the table rows in the container
  container.innerHTML = htmlRows.join('');
  }


</script>






<!-- CSS -->
<style>
  #map {
    width: 70%;
    /* Set the width to 70% the total screen size */
    height: 60vh;
    /* Set height to be 70% the total height as well */
    border-radius: 15px;
    /* round the corners of the map */
    margin-left: 5%;
    /* leave a small space on the left side */
    margin-right: 10%;
    /* Extra space on the right side so we can list the options as well */
    float: left;
    /* Float the map container to the left */
  }

  #locationTable {
    width: 50%;
    float: left;
    /* Change the float property to "left" to move it to the right */
  }

  /* Container to align elements horizontally */
  #container {
    display: flex;
    flex-direction: row;
  }
</style>